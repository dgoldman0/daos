<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Lotto Game Interface</title>
  <!-- Google Fonts for better typography -->
  <link href="https://fonts.googleapis.com/css?family=Press+Start+2P&display=swap" rel="stylesheet">
  <!-- Include Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
  <style>
    /* Reset some default browser styles */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

	/* Scrollbar styling */
	::-webkit-scrollbar {
	width: 12px; /* Set the width of the scrollbar */
	}

	::-webkit-scrollbar-track {
	background: #141414; /* Dark background to match the overall color scheme */
	border-radius: 10px;
	}

	::-webkit-scrollbar-thumb {
	background: #00ffff; /* Bright cyan color to match the button and text highlights */
	border-radius: 10px;
	box-shadow: 0 0 10px #00ffff, 0 0 20px #ff00ff; /* Add neon glow */
	}

	::-webkit-scrollbar-thumb:hover {
	background: #ff00ff; /* Change color on hover to neon magenta for interaction feedback */
	}

    /* Body styling */
    body {
      font-family: 'Press Start 2P', sans-serif; /* Futuristic gamer font */
      background-color: #1a1a1a;
      color: #e2e2e2;
      line-height: 1.6;
      letter-spacing: 0.05em;
      overflow-x: hidden;
    }

    /* Header styling */
    header {
      background-color: #141414;
      padding: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: #ffffff;
      border-bottom: 2px solid #3a3a3a;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
    }

    header h1 {
      font-size: 18px;
      text-transform: uppercase;
      color: #f5f5f5;
      letter-spacing: 0.1em;
      text-shadow: 0 0 10px #00ffff, 0 0 20px #00ffff;
    }

    .connect-wallet {
      padding: 12px 25px;
      background-color: #00ffff;
      color: #1a1a1a;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: 500;
      transition: background-color 0.3s, box-shadow 0.3s;
      text-transform: uppercase;
      font-size: 14px;
      letter-spacing: 0.1em;
      box-shadow: 0 0 15px #00ffff;
    }

    .connect-wallet:hover {
      background-color: #1a1a1a;
      color: #00ffff;
      box-shadow: 0 0 20px #00ffff, 0 0 40px #00ffff;
    }

    /* Container styling */
    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 40px 20px;
    }

    /* Section styling */
    .section h2 {
      margin-top: 40px;
      margin-bottom: 20px;
      font-size: 18px;
      color: #ffffff;
      border-bottom: 3px solid #00ffff;
      padding-bottom: 10px;
      text-transform: uppercase;
      text-shadow: 0 0 10px #ff00ff;
      letter-spacing: 0.1em;
    }

    .info {
      margin-bottom: 10px;
      font-size: 12px;
      color: #dcdcdc;
    }

    .info span {
      font-weight: 600;
      color: #00ffff;
    }

    .button {
      padding: 15px 25px;
      background-color: #00ffff;
      color: #1a1a1a;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: 500;
      font-size: 14px;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      box-shadow: 0 0 15px #00ffff;
      transition: background-color 0.3s, box-shadow 0.3s, transform 0.2s;
      margin-top: 20px;
    }

    .button:hover {
      background-color: #1a1a1a;
      color: #00ffff;
      box-shadow: 0 0 20px #00ffff, 0 0 40px #ff00ff;
      transform: translateY(-2px);
    }

    /* Footer styling */
    footer {
      background-color: #141414;
      padding: 20px;
      text-align: center;
      color: #ffffff;
      border-top: 2px solid #3a3a3a;
      box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.5);
    }

    footer p {
      margin: 0;
      color: #00ffff;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      font-size: 12px;
    }

    /* Notification area */
    #notificationArea {
      position: fixed;
      top: 80px;
      right: 20px;
      width: 300px;
      z-index: 1000;
    }

    .notification {
      background-color: #00ffff;
      color: #1a1a1a;
      padding: 15px;
      margin-bottom: 10px;
      border-radius: 5px;
      animation: fadeOut 4s forwards;
      box-shadow: 0 0 20px #00ffff, 0 0 40px #ff00ff;
    }

    .error-notification {
      background-color: #ff0055;
      box-shadow: 0 0 20px #ff0055, 0 0 40px #ff00ff;
    }

    /* Fade out animation */
    @keyframes fadeOut {
      0% { opacity: 1; }
      75% { opacity: 1; }
      100% { opacity: 0; display: none; }
    }

    /* Responsive design */
    @media (max-width: 768px) {
      .container {
        padding: 20px;
      }

      header h1 {
        font-size: 20px;
      }

      .connect-wallet {
        padding: 8px 16px;
        font-size: 14px;
      }

      .section h2 {
        font-size: 22px;
      }

      .button {
        padding: 12px 20px;
        font-size: 14px;
      }
    }
	.top-menu {
		display: flex;
		justify-content: flex-start;
		align-items: center;
		padding: 10px 20px;
		background-color: #141414;
		border-bottom: 2px solid #3a3a3a;
		box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
	}
	.menu-item {
		padding: 10px 20px;
		color: #ffffff;
		cursor: pointer;
		font-weight: 500;
		font-size: 14px;
		letter-spacing: 0.1em;
		text-transform: uppercase;
	}
	.menu-item:hover {
		color: #167fa6;
	}
	.key-list {
		display: flex;
		overflow: auto;
		white-space: nowrap;
		margin-top: 10px;
		margin-bottom: 20px;
		padding: 20px 0px;
		
	}
	.key-item {
		padding: 20px 20px;
		background-color: #00ffff;
		color: #1a1a1a;
		border-radius: 5px;
		cursor: pointer;
		font-weight: 500;
		font-size: 14px;
		letter-spacing: 0.1em;
		margin-right: 20px;
		margin-left: 20px;
		box-shadow: 0 0 15px #00ffff;
	}		
	.key-item:hover {
		background-color: #1a1a1a;
		color: #00ffff;
		box-shadow: 0 0 20px #00ffff, 0 0 40px #ff00ff;
	}
	.key-item-disabled {
		padding: 20px 20px;
		background-color: #ff0055;
		color: #1a1a1a;
		border-radius: 5px;
		cursor: pointer;
		font-weight: 500;
		font-size: 14px;
		letter-spacing: 0.1em;
		margin-right: 20px;
		margin-left: 20px;
		box-shadow: 0 0 15px #ff0055;
	}

  </style>
</head>
<body>
  <header>
    <h1><i class="fas fa-dice"></i> Lotto Game Interface</h1>
    <button id="connectWalletButton" class="connect-wallet">Connect Wallet</button>
  </header>
  <div class = "top-menu">
	<a class = "menu-item" href="/">Home</a>
	<a class = "menu-item" href="/pool">Claim Pool</a>
  </div>

  <!-- Notification Area -->
  <div id="notificationArea"></div>

  <div class="container">
    <!-- Lotto Game Section -->
    <div class="section" id="lottoGameSection">
      <h2>Lotto Game</h2>
      <div class="info">Entry Fee: <span id="entryFee"></span></div>
      <div class="info">Prize Amount: <span id="prizeAmount"></span></div>
      <div class="info">Odds of Winning: <span id="odds"></span></div>
	  <div class="info">Expected Gain/Loss: <span id="expectedGainLoss"></span></div>
    </div>
	<div class="section" id="keySection">
		<h2>Keys</h2>
		<div class="info">Minimum Key Age: <span id="minKeyAge"></span></div>
		<div class="info">Minimum Key Health: <span id="minKeyHealth"></span></div>
		<div class="info">Minimum Key Claims: <span id="minKeyClaims"></span></div>
		<div class="info">Cooldown Period: <span id="cooldownPeriod"></span></div>

		<div class = "key-list" id = "keyList">
		  </div>
		</div>
    <!-- Result Section -->
    <div class="section" id="resultSection">
      <h2>Result</h2>
      <div class="info" id="resultMessage">Select a key to test your luck!</div>
    </div>

	<!-- Contract Address Section -->
	<div class="section" id="contractAddressSection">
	  <h2>Contract Address</h2>
	  <div class="info">Lotto Contract Address: <span id="lottoContractAddress"></span></div>
	</div>
  </div>

  <footer>
    <p>&copy; 2024 Arcadium DAO</p>
  </footer>

  <!-- Include web3.js CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/4.12.1/web3.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bignumber.js/8.0.2/bignumber.min.js"></script>  
  <script>
    // Contract ABI (replace with actual ABI)
    const lottoAbi = [
			{
				"inputs": [],
				"stateMutability": "nonpayable",
				"type": "constructor"
			},
			{
				"anonymous": false,
				"inputs": [
					{
						"indexed": true,
						"internalType": "address",
						"name": "cancelledBy",
						"type": "address"
					}
				],
				"name": "NominationCancelled",
				"type": "event"
			},
			{
				"anonymous": false,
				"inputs": [
					{
						"indexed": true,
						"internalType": "address",
						"name": "newOwner",
						"type": "address"
					}
				],
				"name": "OwnerNominated",
				"type": "event"
			},
			{
				"anonymous": false,
				"inputs": [
					{
						"indexed": true,
						"internalType": "address",
						"name": "previousOwner",
						"type": "address"
					},
					{
						"indexed": true,
						"internalType": "address",
						"name": "newOwner",
						"type": "address"
					}
				],
				"name": "OwnershipTransferred",
				"type": "event"
			},
			{
				"anonymous": false,
				"inputs": [
					{
						"indexed": true,
						"internalType": "address",
						"name": "player",
						"type": "address"
					},
					{
						"indexed": true,
						"internalType": "uint256",
						"name": "key",
						"type": "uint256"
					},
					{
						"indexed": false,
						"internalType": "uint256",
						"name": "seed",
						"type": "uint256"
					},
					{
						"indexed": false,
						"internalType": "uint256",
						"name": "random",
						"type": "uint256"
					},
					{
						"indexed": false,
						"internalType": "bool",
						"name": "win",
						"type": "bool"
					},
					{
						"indexed": false,
						"internalType": "uint256",
						"name": "prize",
						"type": "uint256"
					}
				],
				"name": "Play",
				"type": "event"
			},
			{
				"inputs": [],
				"name": "acceptOwnership",
				"outputs": [],
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"inputs": [],
				"name": "cancelTransfer",
				"outputs": [],
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "address",
						"name": "newOwner",
						"type": "address"
					}
				],
				"name": "changeOwner",
				"outputs": [],
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"inputs": [],
				"name": "cooldownPeriod",
				"outputs": [
					{
						"internalType": "uint256",
						"name": "",
						"type": "uint256"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [],
				"name": "feeAmount",
				"outputs": [
					{
						"internalType": "uint256",
						"name": "",
						"type": "uint256"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [],
				"name": "feeToken",
				"outputs": [
					{
						"internalType": "address",
						"name": "",
						"type": "address"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [],
				"name": "getPrizeAmount",
				"outputs": [
					{
						"internalType": "uint256",
						"name": "",
						"type": "uint256"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "uint256",
						"name": "_key",
						"type": "uint256"
					}
				],
				"name": "isKeyEligible",
				"outputs": [
					{
						"internalType": "bool",
						"name": "",
						"type": "bool"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "uint256",
						"name": "",
						"type": "uint256"
					}
				],
				"name": "lastPlayed",
				"outputs": [
					{
						"internalType": "uint256",
						"name": "",
						"type": "uint256"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [],
				"name": "minKeyAge",
				"outputs": [
					{
						"internalType": "uint256",
						"name": "",
						"type": "uint256"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [],
				"name": "minKeyClaims",
				"outputs": [
					{
						"internalType": "uint256",
						"name": "",
						"type": "uint256"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [],
				"name": "minKeyHealth",
				"outputs": [
					{
						"internalType": "uint256",
						"name": "",
						"type": "uint256"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [],
				"name": "nominationDate",
				"outputs": [
					{
						"internalType": "uint256",
						"name": "",
						"type": "uint256"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [],
				"name": "odds",
				"outputs": [
					{
						"internalType": "uint128",
						"name": "",
						"type": "uint128"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [],
				"name": "owner",
				"outputs": [
					{
						"internalType": "address",
						"name": "",
						"type": "address"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [],
				"name": "ownerNominee",
				"outputs": [
					{
						"internalType": "address",
						"name": "",
						"type": "address"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "uint256",
						"name": "_key",
						"type": "uint256"
					}
				],
				"name": "play",
				"outputs": [
					{
						"internalType": "uint256",
						"name": "_prize",
						"type": "uint256"
					}
				],
				"stateMutability": "payable",
				"type": "function"
			},
			{
				"inputs": [],
				"name": "prizeAmount",
				"outputs": [
					{
						"internalType": "uint256",
						"name": "",
						"type": "uint256"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [],
				"name": "prizePermyriad",
				"outputs": [
					{
						"internalType": "uint256",
						"name": "",
						"type": "uint256"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [],
				"name": "randomseedgenerator",
				"outputs": [
					{
						"internalType": "address",
						"name": "",
						"type": "address"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [],
				"name": "rejectOwnership",
				"outputs": [],
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"inputs": [],
				"name": "rewardToken",
				"outputs": [
					{
						"internalType": "address",
						"name": "",
						"type": "address"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "uint256",
						"name": "_cooldownPeriod",
						"type": "uint256"
					}
				],
				"name": "setCooldownPeriod",
				"outputs": [],
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "uint256",
						"name": "_feeAmount",
						"type": "uint256"
					}
				],
				"name": "setFeeAmount",
				"outputs": [],
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "address",
						"name": "_feeToken",
						"type": "address"
					}
				],
				"name": "setFeeToken",
				"outputs": [],
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "address",
						"name": "_keyDataManager",
						"type": "address"
					}
				],
				"name": "setKeyDataManager",
				"outputs": [],
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "address",
						"name": "_keyNFTContract",
						"type": "address"
					}
				],
				"name": "setKeyNFTContract",
				"outputs": [],
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "uint256",
						"name": "_minKeyAge",
						"type": "uint256"
					}
				],
				"name": "setMinKeyAge",
				"outputs": [],
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "uint256",
						"name": "_minKeyClaims",
						"type": "uint256"
					}
				],
				"name": "setMinKeyClaims",
				"outputs": [],
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "uint256",
						"name": "_minKeyHealth",
						"type": "uint256"
					}
				],
				"name": "setMinKeyHealth",
				"outputs": [],
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "uint128",
						"name": "_odds",
						"type": "uint128"
					}
				],
				"name": "setOdds",
				"outputs": [],
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "uint256",
						"name": "_prizeAmount",
						"type": "uint256"
					}
				],
				"name": "setPrizeAmount",
				"outputs": [],
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "uint256",
						"name": "_prizePermyriad",
						"type": "uint256"
					}
				],
				"name": "setPrizePermyriad",
				"outputs": [],
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "address",
						"name": "_randomseedgenerator",
						"type": "address"
					}
				],
				"name": "setRandomSeedGenerator",
				"outputs": [],
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "address",
						"name": "_rewardToken",
						"type": "address"
					}
				],
				"name": "setRewardToken",
				"outputs": [],
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "address",
						"name": "_token",
						"type": "address"
					}
				],
				"name": "withdraw",
				"outputs": [],
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"stateMutability": "payable",
				"type": "receive"
			}
		];

	const claimManagerAbi = [
			{
				"inputs": [
					{
						"internalType": "address",
						"name": "_nftContract",
						"type": "address"
					},
					{
						"internalType": "address",
						"name": "_potionToken",
						"type": "address"
					},
					{
						"internalType": "address",
						"name": "_paymentManager",
						"type": "address"
					},
					{
						"internalType": "uint256",
						"name": "_claimerLimit",
						"type": "uint256"
					},
					{
						"internalType": "uint256",
						"name": "_claimPeriod",
						"type": "uint256"
					},
					{
						"internalType": "uint8",
						"name": "_min_health",
						"type": "uint8"
					}
				],
				"stateMutability": "nonpayable",
				"type": "constructor"
			},
			{
				"anonymous": false,
				"inputs": [
					{
						"indexed": true,
						"internalType": "address",
						"name": "claimant",
						"type": "address"
					},
					{
						"indexed": true,
						"internalType": "uint256",
						"name": "tokenId",
						"type": "uint256"
					}
				],
				"name": "Claim",
				"type": "event"
			},
			{
				"anonymous": false,
				"inputs": [
					{
						"indexed": true,
						"internalType": "address",
						"name": "cancelledBy",
						"type": "address"
					}
				],
				"name": "NominationCancelled",
				"type": "event"
			},
			{
				"anonymous": false,
				"inputs": [
					{
						"indexed": true,
						"internalType": "address",
						"name": "newOwner",
						"type": "address"
					}
				],
				"name": "OwnerNominated",
				"type": "event"
			},
			{
				"anonymous": false,
				"inputs": [
					{
						"indexed": true,
						"internalType": "address",
						"name": "previousOwner",
						"type": "address"
					},
					{
						"indexed": true,
						"internalType": "address",
						"name": "newOwner",
						"type": "address"
					}
				],
				"name": "OwnershipTransferred",
				"type": "event"
			},
			{
				"anonymous": false,
				"inputs": [
					{
						"indexed": true,
						"internalType": "address",
						"name": "owner",
						"type": "address"
					},
					{
						"indexed": true,
						"internalType": "uint256",
						"name": "tokenId",
						"type": "uint256"
					},
					{
						"indexed": false,
						"internalType": "uint256",
						"name": "qnt",
						"type": "uint256"
					}
				],
				"name": "TokenRepaired",
				"type": "event"
			},
			{
				"inputs": [],
				"name": "acceptOwnership",
				"outputs": [],
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"inputs": [],
				"name": "cancelTransfer",
				"outputs": [],
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "address",
						"name": "newOwner",
						"type": "address"
					}
				],
				"name": "changeOwner",
				"outputs": [],
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "uint256",
						"name": "tokenId",
						"type": "uint256"
					}
				],
				"name": "claim",
				"outputs": [],
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"inputs": [],
				"name": "claimPeriod",
				"outputs": [
					{
						"internalType": "uint256",
						"name": "",
						"type": "uint256"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "uint256",
						"name": "index",
						"type": "uint256"
					}
				],
				"name": "claimant",
				"outputs": [
					{
						"components": [
							{
								"internalType": "address",
								"name": "addr",
								"type": "address"
							},
							{
								"internalType": "uint256",
								"name": "tokenId",
								"type": "uint256"
							}
						],
						"internalType": "struct ClaimNFTManager.Claimant",
						"name": "",
						"type": "tuple"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "uint256",
						"name": "",
						"type": "uint256"
					}
				],
				"name": "claimants",
				"outputs": [
					{
						"internalType": "address",
						"name": "addr",
						"type": "address"
					},
					{
						"internalType": "uint256",
						"name": "tokenId",
						"type": "uint256"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [],
				"name": "claimerLimit",
				"outputs": [
					{
						"internalType": "uint256",
						"name": "",
						"type": "uint256"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "address",
						"name": "",
						"type": "address"
					}
				],
				"name": "controllers",
				"outputs": [
					{
						"internalType": "bool",
						"name": "",
						"type": "bool"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [],
				"name": "deleteClaimants",
				"outputs": [],
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"inputs": [],
				"name": "getClaimants",
				"outputs": [
					{
						"components": [
							{
								"internalType": "address",
								"name": "addr",
								"type": "address"
							},
							{
								"internalType": "uint256",
								"name": "tokenId",
								"type": "uint256"
							}
						],
						"internalType": "struct ClaimNFTManager.Claimant[]",
						"name": "",
						"type": "tuple[]"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [],
				"name": "getClaimantsCount",
				"outputs": [
					{
						"internalType": "uint256",
						"name": "",
						"type": "uint256"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "uint256",
						"name": "tokenId",
						"type": "uint256"
					}
				],
				"name": "getHealth",
				"outputs": [
					{
						"internalType": "uint8",
						"name": "",
						"type": "uint8"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "uint256",
						"name": "tokenId",
						"type": "uint256"
					}
				],
				"name": "getMintDate",
				"outputs": [
					{
						"internalType": "uint256",
						"name": "",
						"type": "uint256"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "uint256",
						"name": "tokenId",
						"type": "uint256"
					}
				],
				"name": "getTotalClaims",
				"outputs": [
					{
						"internalType": "uint256",
						"name": "",
						"type": "uint256"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "uint256",
						"name": "tokenId",
						"type": "uint256"
					}
				],
				"name": "hasClaimedInPeriod",
				"outputs": [
					{
						"internalType": "bool",
						"name": "",
						"type": "bool"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "uint256",
						"name": "tokenId",
						"type": "uint256"
					}
				],
				"name": "initializeNFT",
				"outputs": [],
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"inputs": [],
				"name": "isClaimReady",
				"outputs": [
					{
						"internalType": "bool",
						"name": "",
						"type": "bool"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [],
				"name": "min_health",
				"outputs": [
					{
						"internalType": "uint8",
						"name": "",
						"type": "uint8"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [],
				"name": "nftContract",
				"outputs": [
					{
						"internalType": "address",
						"name": "",
						"type": "address"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [],
				"name": "nominationDate",
				"outputs": [
					{
						"internalType": "uint256",
						"name": "",
						"type": "uint256"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [],
				"name": "owner",
				"outputs": [
					{
						"internalType": "address",
						"name": "",
						"type": "address"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [],
				"name": "ownerNominee",
				"outputs": [
					{
						"internalType": "address",
						"name": "",
						"type": "address"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [],
				"name": "paymentManager",
				"outputs": [
					{
						"internalType": "address",
						"name": "",
						"type": "address"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [],
				"name": "potionToken",
				"outputs": [
					{
						"internalType": "address",
						"name": "",
						"type": "address"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [],
				"name": "rejectOwnership",
				"outputs": [],
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "uint256",
						"name": "tokenId",
						"type": "uint256"
					},
					{
						"internalType": "uint8",
						"name": "_qnt",
						"type": "uint8"
					}
				],
				"name": "repair",
				"outputs": [],
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "uint256",
						"name": "tokenId",
						"type": "uint256"
					}
				],
				"name": "resetClaim",
				"outputs": [],
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "uint256",
						"name": "_claimPeriod",
						"type": "uint256"
					}
				],
				"name": "setClaimPeriod",
				"outputs": [],
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "uint256",
						"name": "_claimerLimit",
						"type": "uint256"
					}
				],
				"name": "setClaimerLimit",
				"outputs": [],
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "uint8",
						"name": "_min_health",
						"type": "uint8"
					}
				],
				"name": "setMinHealth",
				"outputs": [],
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "address",
						"name": "_nftContract",
						"type": "address"
					}
				],
				"name": "setNFTContract",
				"outputs": [],
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "address",
						"name": "_paymentManager",
						"type": "address"
					}
				],
				"name": "setPaymentManager",
				"outputs": [],
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "address",
						"name": "_potionToken",
						"type": "address"
					}
				],
				"name": "setPotionToken",
				"outputs": [],
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "address",
						"name": "_token",
						"type": "address"
					}
				],
				"name": "withdraw",
				"outputs": [],
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"stateMutability": "payable",
				"type": "receive"
			}
		];

	const erc20Abi = [
		{
			"inputs": [],
			"stateMutability": "nonpayable",
			"type": "constructor"
		},
		{
			"anonymous": false,
			"inputs": [
				{
					"indexed": true,
					"internalType": "address",
					"name": "owner",
					"type": "address"
				},
				{
					"indexed": true,
					"internalType": "address",
					"name": "spender",
					"type": "address"
				},
				{
					"indexed": false,
					"internalType": "uint256",
					"name": "value",
					"type": "uint256"
				}
			],
			"name": "Approval",
			"type": "event"
		},
		{
			"anonymous": false,
			"inputs": [
				{
					"indexed": true,
					"internalType": "address",
					"name": "from",
					"type": "address"
				},
				{
					"indexed": true,
					"internalType": "address",
					"name": "to",
					"type": "address"
				},
				{
					"indexed": false,
					"internalType": "uint256",
					"name": "value",
					"type": "uint256"
				}
			],
			"name": "Transfer",
			"type": "event"
		},
		{
			"inputs": [
				{
					"internalType": "address",
					"name": "owner",
					"type": "address"
				},
				{
					"internalType": "address",
					"name": "spender",
					"type": "address"
				}
			],
			"name": "allowance",
			"outputs": [
				{
					"internalType": "uint256",
					"name": "",
					"type": "uint256"
				}
			],
			"stateMutability": "view",
			"type": "function"
		},
		{
			"inputs": [
				{
					"internalType": "address",
					"name": "spender",
					"type": "address"
				},
				{
					"internalType": "uint256",
					"name": "amount",
					"type": "uint256"
				}
			],
			"name": "approve",
			"outputs": [
				{
					"internalType": "bool",
					"name": "",
					"type": "bool"
				}
			],
			"stateMutability": "nonpayable",
			"type": "function"
		},
		{
			"inputs": [
				{
					"internalType": "address",
					"name": "account",
					"type": "address"
				}
			],
			"name": "balanceOf",
			"outputs": [
				{
					"internalType": "uint256",
					"name": "",
					"type": "uint256"
				}
			],
			"stateMutability": "view",
			"type": "function"
		},
		{
			"inputs": [],
			"name": "decimals",
			"outputs": [
				{
					"internalType": "uint8",
					"name": "",
					"type": "uint8"
				}
			],
			"stateMutability": "view",
			"type": "function"
		},
		{
			"inputs": [
				{
					"internalType": "address",
					"name": "spender",
					"type": "address"
				},
				{
					"internalType": "uint256",
					"name": "subtractedValue",
					"type": "uint256"
				}
			],
			"name": "decreaseAllowance",
			"outputs": [
				{
					"internalType": "bool",
					"name": "",
					"type": "bool"
				}
			],
			"stateMutability": "nonpayable",
			"type": "function"
		},
		{
			"inputs": [
				{
					"internalType": "address",
					"name": "spender",
					"type": "address"
				},
				{
					"internalType": "uint256",
					"name": "addedValue",
					"type": "uint256"
				}
			],
			"name": "increaseAllowance",
			"outputs": [
				{
					"internalType": "bool",
					"name": "",
					"type": "bool"
				}
			],
			"stateMutability": "nonpayable",
			"type": "function"
		},
		{
			"inputs": [],
			"name": "name",
			"outputs": [
				{
					"internalType": "string",
					"name": "",
					"type": "string"
				}
			],
			"stateMutability": "view",
			"type": "function"
		},
		{
			"inputs": [],
			"name": "symbol",
			"outputs": [
				{
					"internalType": "string",
					"name": "",
					"type": "string"
				}
			],
			"stateMutability": "view",
			"type": "function"
		},
		{
			"inputs": [],
			"name": "totalSupply",
			"outputs": [
				{
					"internalType": "uint256",
					"name": "",
					"type": "uint256"
				}
			],
			"stateMutability": "view",
			"type": "function"
		},
		{
			"inputs": [
				{
					"internalType": "address",
					"name": "to",
					"type": "address"
				},
				{
					"internalType": "uint256",
					"name": "amount",
					"type": "uint256"
				}
			],
			"name": "transfer",
			"outputs": [
				{
					"internalType": "bool",
					"name": "",
					"type": "bool"
				}
			],
			"stateMutability": "nonpayable",
			"type": "function"
		},
		{
			"inputs": [
				{
					"internalType": "address",
					"name": "from",
					"type": "address"
				},
				{
					"internalType": "address",
					"name": "to",
					"type": "address"
				},
				{
					"internalType": "uint256",
					"name": "amount",
					"type": "uint256"
				}
			],
			"name": "transferFrom",
			"outputs": [
				{
					"internalType": "bool",
					"name": "",
					"type": "bool"
				}
			],
			"stateMutability": "nonpayable",
			"type": "function"
		}
	];

    const nftAbi = [
			{
				"inputs": [],
				"stateMutability": "nonpayable",
				"type": "constructor"
			},
			{
				"anonymous": false,
				"inputs": [
					{
						"indexed": true,
						"internalType": "address",
						"name": "owner",
						"type": "address"
					},
					{
						"indexed": true,
						"internalType": "address",
						"name": "approved",
						"type": "address"
					},
					{
						"indexed": true,
						"internalType": "uint256",
						"name": "tokenId",
						"type": "uint256"
					}
				],
				"name": "Approval",
				"type": "event"
			},
			{
				"anonymous": false,
				"inputs": [
					{
						"indexed": true,
						"internalType": "address",
						"name": "owner",
						"type": "address"
					},
					{
						"indexed": true,
						"internalType": "address",
						"name": "operator",
						"type": "address"
					},
					{
						"indexed": false,
						"internalType": "bool",
						"name": "approved",
						"type": "bool"
					}
				],
				"name": "ApprovalForAll",
				"type": "event"
			},
			{
				"anonymous": false,
				"inputs": [
					{
						"indexed": true,
						"internalType": "address",
						"name": "minter",
						"type": "address"
					},
					{
						"indexed": true,
						"internalType": "uint256",
						"name": "tokenId",
						"type": "uint256"
					}
				],
				"name": "NFTMinted",
				"type": "event"
			},
			{
				"anonymous": false,
				"inputs": [
					{
						"indexed": true,
						"internalType": "address",
						"name": "cancelledBy",
						"type": "address"
					}
				],
				"name": "NominationCancelled",
				"type": "event"
			},
			{
				"anonymous": false,
				"inputs": [
					{
						"indexed": true,
						"internalType": "address",
						"name": "newOwner",
						"type": "address"
					}
				],
				"name": "OwnerNominated",
				"type": "event"
			},
			{
				"anonymous": false,
				"inputs": [
					{
						"indexed": true,
						"internalType": "address",
						"name": "previousOwner",
						"type": "address"
					},
					{
						"indexed": true,
						"internalType": "address",
						"name": "newOwner",
						"type": "address"
					}
				],
				"name": "OwnershipTransferred",
				"type": "event"
			},
			{
				"anonymous": false,
				"inputs": [
					{
						"indexed": true,
						"internalType": "address",
						"name": "from",
						"type": "address"
					},
					{
						"indexed": true,
						"internalType": "address",
						"name": "to",
						"type": "address"
					},
					{
						"indexed": true,
						"internalType": "uint256",
						"name": "tokenId",
						"type": "uint256"
					}
				],
				"name": "Transfer",
				"type": "event"
			},
			{
				"inputs": [],
				"name": "acceptOwnership",
				"outputs": [],
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "address",
						"name": "to",
						"type": "address"
					},
					{
						"internalType": "uint256",
						"name": "tokenId",
						"type": "uint256"
					}
				],
				"name": "approve",
				"outputs": [],
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "address",
						"name": "owner",
						"type": "address"
					}
				],
				"name": "balanceOf",
				"outputs": [
					{
						"internalType": "uint256",
						"name": "",
						"type": "uint256"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [],
				"name": "cancelTransfer",
				"outputs": [],
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "address",
						"name": "newOwner",
						"type": "address"
					}
				],
				"name": "changeOwner",
				"outputs": [],
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"inputs": [],
				"name": "claimManager",
				"outputs": [
					{
						"internalType": "address",
						"name": "",
						"type": "address"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [],
				"name": "firstMintDate",
				"outputs": [
					{
						"internalType": "uint256",
						"name": "",
						"type": "uint256"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [],
				"name": "fundReceiver",
				"outputs": [
					{
						"internalType": "address payable",
						"name": "",
						"type": "address"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "uint256",
						"name": "tokenId",
						"type": "uint256"
					}
				],
				"name": "getApproved",
				"outputs": [
					{
						"internalType": "address",
						"name": "",
						"type": "address"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "address",
						"name": "owner",
						"type": "address"
					},
					{
						"internalType": "address",
						"name": "operator",
						"type": "address"
					}
				],
				"name": "isApprovedForAll",
				"outputs": [
					{
						"internalType": "bool",
						"name": "",
						"type": "bool"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [],
				"name": "maxSupply",
				"outputs": [
					{
						"internalType": "uint256",
						"name": "",
						"type": "uint256"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "uint256",
						"name": "_count",
						"type": "uint256"
					}
				],
				"name": "mint",
				"outputs": [],
				"stateMutability": "payable",
				"type": "function"
			},
			{
				"inputs": [],
				"name": "mintPrice",
				"outputs": [
					{
						"internalType": "uint256",
						"name": "",
						"type": "uint256"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "address",
						"name": "_to",
						"type": "address"
					},
					{
						"internalType": "uint256",
						"name": "_count",
						"type": "uint256"
					}
				],
				"name": "mintTo",
				"outputs": [],
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"inputs": [],
				"name": "name",
				"outputs": [
					{
						"internalType": "string",
						"name": "",
						"type": "string"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [],
				"name": "nextTokenId",
				"outputs": [
					{
						"internalType": "uint256",
						"name": "",
						"type": "uint256"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [],
				"name": "nominationDate",
				"outputs": [
					{
						"internalType": "uint256",
						"name": "",
						"type": "uint256"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [],
				"name": "owner",
				"outputs": [
					{
						"internalType": "address",
						"name": "",
						"type": "address"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [],
				"name": "ownerNominee",
				"outputs": [
					{
						"internalType": "address",
						"name": "",
						"type": "address"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "uint256",
						"name": "tokenId",
						"type": "uint256"
					}
				],
				"name": "ownerOf",
				"outputs": [
					{
						"internalType": "address",
						"name": "",
						"type": "address"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [],
				"name": "paymentToken",
				"outputs": [
					{
						"internalType": "address",
						"name": "",
						"type": "address"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [],
				"name": "rejectOwnership",
				"outputs": [],
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "address",
						"name": "from",
						"type": "address"
					},
					{
						"internalType": "address",
						"name": "to",
						"type": "address"
					},
					{
						"internalType": "uint256",
						"name": "tokenId",
						"type": "uint256"
					}
				],
				"name": "safeTransferFrom",
				"outputs": [],
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "address",
						"name": "from",
						"type": "address"
					},
					{
						"internalType": "address",
						"name": "to",
						"type": "address"
					},
					{
						"internalType": "uint256",
						"name": "tokenId",
						"type": "uint256"
					},
					{
						"internalType": "bytes",
						"name": "data",
						"type": "bytes"
					}
				],
				"name": "safeTransferFrom",
				"outputs": [],
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "address",
						"name": "operator",
						"type": "address"
					},
					{
						"internalType": "bool",
						"name": "approved",
						"type": "bool"
					}
				],
				"name": "setApprovalForAll",
				"outputs": [],
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "string",
						"name": "baseTokenURI",
						"type": "string"
					}
				],
				"name": "setBaseTokenURI",
				"outputs": [],
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "address",
						"name": "_claimManager",
						"type": "address"
					}
				],
				"name": "setClaimManager",
				"outputs": [],
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "address payable",
						"name": "_fundReceiver",
						"type": "address"
					}
				],
				"name": "setFundReceiver",
				"outputs": [],
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "uint256",
						"name": "_maxSupply",
						"type": "uint256"
					}
				],
				"name": "setMaxSupply",
				"outputs": [],
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "address",
						"name": "_paymentToken",
						"type": "address"
					}
				],
				"name": "setPaymentToken",
				"outputs": [],
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "uint256",
						"name": "_price",
						"type": "uint256"
					}
				],
				"name": "setPrice",
				"outputs": [],
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "bytes4",
						"name": "interfaceId",
						"type": "bytes4"
					}
				],
				"name": "supportsInterface",
				"outputs": [
					{
						"internalType": "bool",
						"name": "",
						"type": "bool"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [],
				"name": "symbol",
				"outputs": [
					{
						"internalType": "string",
						"name": "",
						"type": "string"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "uint256",
						"name": "index",
						"type": "uint256"
					}
				],
				"name": "tokenByIndex",
				"outputs": [
					{
						"internalType": "uint256",
						"name": "",
						"type": "uint256"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "address",
						"name": "owner",
						"type": "address"
					},
					{
						"internalType": "uint256",
						"name": "index",
						"type": "uint256"
					}
				],
				"name": "tokenOfOwnerByIndex",
				"outputs": [
					{
						"internalType": "uint256",
						"name": "",
						"type": "uint256"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "uint256",
						"name": "tokenId",
						"type": "uint256"
					}
				],
				"name": "tokenURI",
				"outputs": [
					{
						"internalType": "string",
						"name": "",
						"type": "string"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [],
				"name": "totalSupply",
				"outputs": [
					{
						"internalType": "uint256",
						"name": "",
						"type": "uint256"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "address",
						"name": "from",
						"type": "address"
					},
					{
						"internalType": "address",
						"name": "to",
						"type": "address"
					},
					{
						"internalType": "uint256",
						"name": "tokenId",
						"type": "uint256"
					}
				],
				"name": "transferFrom",
				"outputs": [],
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "address",
						"name": "_token",
						"type": "address"
					}
				],
				"name": "withdraw",
				"outputs": [],
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"stateMutability": "payable",
				"type": "receive"
			}
		];

	// Replace with actual contract address
    const lottoContractAddress = '0x58C5f8ED50aDb8B2c8E8bBe847d98283B519e3f0';
    const claimManagerAddress = '0x6Ed1c7185da8B225c292d9d4c7ad675637a5C0b4';
	const nftContractAddress = "0xe75c2251478A2DA595B29e417d813B042D5d83aC";

    document.addEventListener('DOMContentLoaded', async () => {
      let web3;
      let userAddress;
      let lottoContract;
	  let claimManagerContract;
	  let nftContract;

      const connectWalletButton = document.getElementById('connectWalletButton');
      connectWalletButton.addEventListener('click', async () => {
        await connectWallet();
      });

      async function connectWallet() {
        if (window.ethereum) {
          try {
            await window.ethereum.request({ method: 'eth_requestAccounts' });
            web3 = new Web3(window.ethereum);
            const accounts = await web3.eth.getAccounts();
            userAddress = accounts[0];
            connectWalletButton.textContent = `${userAddress.substring(0, 6)}...${userAddress.substring(userAddress.length - 4)}`;
            initializeContracts();
            refreshData();
          } catch (error) {
            console.error('User denied account access');
          }
        } else {
          alert('Please install MetaMask!');
        }
      }

      function initializeContracts() {
        lottoContract = new web3.eth.Contract(lottoAbi, lottoContractAddress);
		claimManagerContract = new web3.eth.Contract(claimManagerAbi, claimManagerAddress);
		nftContract = new web3.eth.Contract(nftAbi, nftContractAddress);
      }

      async function refreshData() {
        await loadLottoParameters();
		await loadKeys();		
      }

	  // Load keys
	  async function loadKeys() {
		try {
			// Get list of keys owned by the user from the NFT contract (is ERC721 enumerable). Standard ERC721 enumerable method to get all tokens owned by an address is tokenOfOwnerByIndex
		 	const balance = parseInt((await nftContract.methods.balanceOf(userAddress).call()).toString());
			const minKeyHealth = await lottoContract.methods.minKeyHealth().call();
		  
			const minKeyAge = await lottoContract.methods.minKeyAge().call();
			const minKeyClaims = await lottoContract.methods.minKeyClaims().call();
			const cooldownPeriod = parseInt((await lottoContract.methods.cooldownPeriod().call()).toString());

			// Update the UI with the minimum details
			document.getElementById('minKeyHealth').textContent = minKeyHealth;
			document.getElementById('minKeyAge').textContent = minKeyAge;
			document.getElementById('minKeyClaims').textContent = minKeyClaims;
			document.getElementById('cooldownPeriod').textContent = cooldownPeriod + ' seconds';

			const keysList = document.getElementById('keyList');
			keysList.innerHTML = '';

			for (let i = 0; i < balance; i++) {
				const tokenId = await nftContract.methods.tokenOfOwnerByIndex(userAddress, i).call();
				// Get key details. Consider the data manager abi. We need the mint date, health, and total claims.
				const totalClaims = await claimManagerContract.methods.getTotalClaims(tokenId).call();
				const health = await claimManagerContract.methods.getHealth(tokenId).call();
				const mintDate = await claimManagerContract.methods.getMintDate(tokenId).call();
				const age = Math.floor((Date.now() / 1000) - parseInt(mintDate));
	
				// mapping (uint256 => uint256) public lastPlayed; // Record of when the NFT last used to play
				const lastPlayed = await lottoContract.methods.lastPlayed(tokenId).call();
				const timeSinceLastPlayed = Math.floor((Date.now() / 1000) - parseInt(lastPlayed));
			
				const validKey = age >= minKeyAge && totalClaims >= minKeyClaims && health >= minKeyHealth;
				if (validKey && timeSinceLastPlayed >= cooldownPeriod) {
					const keyItem = document.createElement('div');
					keyItem.className = 'key-item';
					keyItem.innerHTML = "<i class='fas fa-key'></i> " + tokenId;
					keyItem.addEventListener('click', () => {
						playLottery(tokenId);
					});
					keysList.appendChild(keyItem);
				} else if (true) {
					// If the key is not eligible, we can show it as disabled
					const keyItem = document.createElement('div');
					keyItem.className = 'key-item-disabled';
					keyItem.innerHTML = "<i class='fas fa-key'></i> " + tokenId;
					keyItem.addEventListener('click', async () => {
						if (validKey) {
							const cooldownPeriod = parseInt((await lottoContract.methods.cooldownPeriod().call()).toString());
							const timeSinceLastPlayed = Math.floor((Date.now() / 1000) - parseInt(lastPlayed));
							if (timeSinceLastPlayed < cooldownPeriod) {
								showNotification(`This key is on cooldown. Please wait ${cooldownPeriod - timeSinceLastPlayed} seconds.`, true);
							} else {
								await loadKeys();
								showNotification('Cooldown elapsed. Reloading.', true);
							}
						} else {
							showNotification('This key is not eligible to play the lottery.', true);
						}
					});
					keysList.appendChild(keyItem);
				}
			}
		} catch (error) {
			console.log('Failed to load keys', error);
		}
	}

      async function loadLottoParameters() {
        try {
          const entryFee = await lottoContract.methods.feeAmount().call();
          const feeTokenAddress = await lottoContract.methods.feeToken().call();
          const prizeAmount = await lottoContract.methods.getPrizeAmount().call();
          const rewardTokenAddress = await lottoContract.methods.rewardToken().call();
          const odds = await lottoContract.methods.odds().call();

		  document.getElementById('lottoContractAddress').textContent = lottoContractAddress;
		  
          let feeTokenSymbol = 'ETH';
          if (feeTokenAddress != '0x0000000000000000000000000000000000000000') {
            const feeTokenContract = new web3.eth.Contract(erc20Abi, feeTokenAddress);
            feeTokenSymbol = await feeTokenContract.methods.symbol().call();
            document.getElementById('entryFee').textContent = `${web3.utils.fromWei(entryFee, 'ether')} ${feeTokenSymbol}`;
          } else {
            document.getElementById('entryFee').textContent = `${web3.utils.fromWei(entryFee, 'ether')} ${feeTokenSymbol}`;
          }

          let rewardTokenSymbol = 'ETH';
          if (rewardTokenAddress != '0x0000000000000000000000000000000000000000') {
            const rewardTokenContract = new web3.eth.Contract(erc20Abi, rewardTokenAddress);
            rewardTokenSymbol = await rewardTokenContract.methods.symbol().call();
            document.getElementById('prizeAmount').textContent = `${web3.utils.fromWei(prizeAmount, 'ether')} ${rewardTokenSymbol}`;
          } else {
            document.getElementById('prizeAmount').textContent = `${web3.utils.fromWei(prizeAmount, 'ether')} ${rewardTokenSymbol}`;
          }

          document.getElementById('odds').textContent = `1 in ${odds}`;

		  // Check if tokens are the same for fee and reward, otherwise we cannot do the calculation right now.
		  if (feeTokenSymbol == rewardTokenSymbol) {
            const feeTokenContract = new web3.eth.Contract(erc20Abi, feeTokenAddress)	;
			const decimals = new BigNumber(await feeTokenContract.methods.decimals().call());
			// Convert to BigNumbers
			const entryFeeBN = new BigNumber(entryFee);
			const prizeAmountBN = new BigNumber(prizeAmount);
			const oddsBN = new BigNumber(odds);
			
			// The exepcted gain is the prize amount / odds - entry fee
			const expectedGainLossBN = prizeAmountBN.div(oddsBN).minus(entryFeeBN).div(new BigNumber(10).pow(decimals));
			document.getElementById('expectedGainLoss').textContent = `${expectedGainLossBN} ${rewardTokenSymbol}`;
		  } else {
			document.getElementById('expectedGainLoss').textContent = 'N/A';
		  }
        } catch (error) {
          console.error('Failed to load lotto parameters', error);
        }
      }

      async function playLottery(keyid) {
        try {
          const entryFee = await lottoContract.methods.feeAmount().call();
          const feeTokenAddress = await lottoContract.methods.feeToken().call();

          let txReceipt;

          if (feeTokenAddress == '0x0000000000000000000000000000000000000000') {
            // ETH payment
            txReceipt = await lottoContract.methods.play(keyid).send({ from: userAddress, value: entryFee });
          } else {
            // ERC20 payment
            const feeTokenContract = new web3.eth.Contract(erc20Abi, feeTokenAddress);
            const allowance = await feeTokenContract.methods.allowance(userAddress, lottoContractAddress).call();
            if (allowance < entryFee) {
              await feeTokenContract.methods.approve(lottoContractAddress, entryFee).send({ from: userAddress });
            }
            txReceipt = await lottoContract.methods.play(keyid).send({ from: userAddress });
          }

          handlePlayEvent(txReceipt);
		  await loadLottoParameters();
		  await loadKeys();
        } catch (error) {
          console.error('Failed to play lottery', error);
          showNotification('Failed to play lottery.', true);
        }
      }

      function handlePlayEvent(txReceipt) {
        if (txReceipt && txReceipt.events && txReceipt.events.Play) {
          const event = txReceipt.events.Play;
          const { player, win, prize } = event.returnValues;

          if (win) {
            document.getElementById('resultMessage').textContent = `Congratulations! You won ${web3.utils.fromWei(prize, 'ether')} tokens!`;
            showNotification('You won the lottery!');
          } else {
            document.getElementById('resultMessage').textContent = `Sorry, you didn't win this time. Try again!`;
            showNotification('You did not win. Better luck next time!');
          }
        } else {
          console.error('Play event not found in receipt', txReceipt);
          showNotification('Failed to retrieve play result.', true);
        }
      }

      function showNotification(message, isError = false) {
        const notificationArea = document.getElementById('notificationArea');
        const notification = document.createElement('div');
        notification.className = 'notification';
        if (isError) {
          notification.classList.add('error-notification');
        }
        notification.textContent = message;
        notificationArea.appendChild(notification);
        setTimeout(() => {
          notificationArea.removeChild(notification);
        }, 4000);
      }

      if (window.ethereum) {
        web3 = new Web3(window.ethereum);
        web3.eth.getAccounts().then(accounts => {
          if (accounts.length > 0) {
            userAddress = accounts[0];
            connectWalletButton.textContent = `${userAddress.substring(0, 6)}...${userAddress.substring(userAddress.length - 4)}`;
            initializeContracts();
            refreshData();
          }
        });
      }
    });
  </script>
</body>
</html>
